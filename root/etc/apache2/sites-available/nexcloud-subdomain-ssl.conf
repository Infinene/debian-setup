<VirtualHost *:80>

        ServerName cloud.example.com
        Redirect permanent / https://cloud.example.com/

</VirtualHost>

# Nginx proxy site does not need ssl
<VirtualHost *:443>

        DocumentRoot /srv/http/cloud.example.com
        ServerName cloud.example.com

        Protocols h2 http/1.1

        ProxyRequests off
        SSLProxyEngine on
        ProxyPreserveHost on

        Header always set Strict-Transport-Security "max-age=63072000;"

        SSLEngine on
        SSLProtocol All -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
        SSLUseStapling on
        SSLHonorCipherOrder on
        SSLCipherSuite      ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384

        SSLCertificateFile       /etc/letsencrypt/live/cloud.example.com/cert.pem
        SSLCertificateKeyFile    /etc/letsencrypt/live/cloud.example.com/privkey.pem
        SSLCertificateChainFile  /etc/letsencrypt/live/cloud.example.com/chain.pem
        SSLOpenSSLConfCmd DHParameters  /etc/nginx/ssl/dhparam.pem

        <Directory /srv/http/cloud.example.com/>

             Require all granted
             Options FollowSymlinks MultiViews
             AllowOverride All

             <IfModule mod_dav.c>
                Dav off
             </IfModule>

             SetEnv HOME /srv/http/cloud.example.com
             SetEnv HTTP_HOME /srv/http/cloud.example.com
             Satisfy Any
        </Directory>


        LogLevel warn
        ErrorLog /var/log/sites/cloud.example.com/error.log
        CustomLog /var/log/sites/cloud.example.com/access.log combined

</VirtualHost>

SSLStaplingCache shmcb:/tmp/stapling_cache(128000)
