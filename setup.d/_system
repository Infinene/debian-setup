### backports ###
grep -e "^deb.*backports" /etc/apt/sources.list >/dev/null || \
    echo -e "\ndeb http://deb.debian.org/debian $(lsb_release -sc)-backports main contrib non-free" \
    | ${SUDO} tee -a /etc/apt/sources.list
echo -e "Package: *\nPin: release a=$(lsb_release -sc)-backports\nPin-Priority: 500\n" \
    | ${SUDO} tee /etc/apt/preferences.d/backports

${SUDO} apt update
${SUDO} apt -y full-upgrade
### required by php-mysql-nginx ###
${SUDO} apt -y install apt-transport-https lsb-release ca-certificates curl software-properties-common dirmngr gnupg2 debian-archive-keyring sudo rsync
### extras ###
${SUDO} apt -y install zsh zsh-syntax-highlighting autojump zstd ncdu git unzip neofetch

### micro ###
cd $HOME
curl https://getmic.ro | bash
${SUDO} mv ./micro /usr/local/bin/
${SUDO} update-alternatives --install /usr/bin/editor editor /usr/local/bin/micro 50

### bash setup ###
echo -e "EDITOR=micro\nVISUAL=micro\n" | ${SUDO} tee -a /etc/environment

echo -e '\n. ~/.config/shell/prompt' | ${SUDO} tee -a $HOME/.bashrc
if [ ! $UID = 0 ]; then
    cp -rTv $SCRIPT_DIR/home $HOME/
    echo -e '\n. ~/.config/shell/prompt' | tee -a $HOME/.bashrc
    echo -e '\n. ~/.config/shell/utils_env' | tee -a $HOME/.bashrc
    echo '. /usr/share/autojump/autojump.bash' | tee -a $HOME/.bashrc
    ln -s $HOME/.config/shell/aliases $HOME/.bash_aliases
    echo -e "\nDefaults:${USER} timestamp_timeout=90" | sudo tee -a /etc/sudoers
    [[ $IS_WSL ]] && echo -e "${USER} ALL=(ALL) NOPASSWD:/usr/sbin/service" | sudo tee -a /etc/sudoers
fi

[ ${SUDO} ] && echo -e "\nInstalling utils..." && $HOME/bin/update_utils