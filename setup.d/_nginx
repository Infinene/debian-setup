### nginx ###
curl https://nginx.org/keys/nginx_signing.key | gpg --dearmor \
    | ${SUDO} tee /usr/share/keyrings/nginx-archive-keyring.gpg >/dev/null
gpg --dry-run --quiet --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx" \
    | ${SUDO} tee /etc/apt/sources.list.d/nginx.list
echo -e "Package: *\nPin: origin nginx.org\nPin: release o=nginx\nPin-Priority: 900\n" \
    | ${SUDO} tee /etc/apt/preferences.d/99nginx

${SUDO} apt update
${SUDO} apt -y install nginx

${SUDO} cp -rbv $setup_dir/etc/nginx/* /etc/nginx
if [ -f /etc/nginx/conf.d/default.conf ]; then
    ${SUDO} mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf~
fi

### create webroot ###
${SUDO} mkdir -p /srv/www/_local
echo $(hostname) | ${SUDO} tee /srv/www/_local/index.php
${SUDO} cp -rv $setup_dir/www/utils /srv/www/_local/

### set permissions ###
${SUDO} chown -R $USER:nginx /srv/www
${SUDO} chmod -R a=rX,u+w /srv/www
${SUDO} find $dir -type d -print0 | xargs -0 -n 10 sudo chmod g+s
