#!/bin/bash
# set -x

nextcloud_user="www-data"
rsync_src="sadmin@soundvision.com:backups/"
dest_dir="/srv/nextcloud/data/__groupfolders/1"
logfile="~/.cache/log/sync_site_backup.log"
scan_cmd="php /srv/nextcloud/occ groupfolders:scan 1"

source ~/.local/lib/logging.sh

start_logging $logfile

log 'Starting rsync...'

if [ ! -d ${dest_dir}/ ]; then
	log "ERROR: $dest_dir does not exist"
	exit 1
fi

sudo rsync -a --delete -og --chown www-data:www-data ${rsync_src}/ ${dest_dir}/
sudo -u ${nextcloud_user} ${scan_cmd}
